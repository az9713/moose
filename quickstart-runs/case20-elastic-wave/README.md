# Case 20: Elastic Wave Propagation in a Bar

## Overview

This case demonstrates dynamic solid mechanics: a compressive stress wave generated by
a short pressure pulse traveling along a steel bar, reflecting off the free right end,
and returning toward the driven left end.

The physical setup is a thin 2D strip (100 x 5 elements on a 10 m x 0.5 m domain) that
approximates a 1D bar. Restricting y-displacements on the top and bottom faces and setting
Poisson's ratio to zero eliminates lateral effects, so the wave travels purely in the
x-direction.

New MOOSE concepts introduced in this case:

- `Physics/SolidMechanics/Dynamic` action — sets up displacement variables, velocity and
  acceleration AuxVariables, StressDivergenceTensors kernels, and InertialForce kernels in
  a single block
- Newmark-beta implicit time integration for second-order wave equations
- Pressure boundary condition applied as a time-dependent traction via a `[Functions]` block
- `PointValue` postprocessors tracking wave arrival at specific locations
- `interval` in `[Outputs]` to control Exodus file size for dynamic simulations

---

## The Physics

### Governing Equation

Dynamic elasticity adds an inertial term to the static equilibrium equation:

```
rho * d^2u/dt^2 = div( sigma ) + f
```

Where:

- `u`     — displacement field vector [m]
- `rho`   — material density [kg/m^3]
- `sigma` — Cauchy stress tensor [Pa], related to strain by Hooke's law
- `f`     — body force per unit volume [N/m^3] (zero here)

For the 1D special case (x-direction only, small strain, nu=0):

```
rho * d^2u_x/dt^2 = d/dx( E * du_x/dx )
```

This is the classical 1D wave equation with wave speed:

```
c = sqrt( E / rho )
  = sqrt( 200e9 / 7800 )
  ~ 5064 m/s
```

This is the longitudinal (P-wave) speed in steel — approximately Mach 14.8.

### Wave Propagation and Reflection

A pressure pulse applied at x=0 launches a compressive stress wave (sigma_xx < 0)
traveling in the +x direction. Key events by time:

```
t = 0.000 s  : Pulse applied at left end (0 to 0.0006 s ramp-up/hold/ramp-down)
t ~ 0.002 s  : Wave front reaches free right end (x = 10 m)
t ~ 0.004 s  : Reflected wave returns to left end (x = 0 m)
t ~ 0.006 s  : Interaction with left end after pulse has released
```

The transit time is `L/c = 10 / 5064 ~ 0.001975 s`.

### Free-End Reflection

At the free right end, the boundary condition is zero traction: `sigma_xx = 0`.
When the compressive wave arrives, the traction would become non-zero if nothing
happened — so to maintain zero traction the boundary generates a reflected wave of
equal magnitude but opposite sign (tensile). The reflected wave is therefore a
tensile stress wave traveling in the -x direction.

At the exact moment of reflection, displacement at the free end doubles (superposition
of incident and reflected waves), then the reflected tensile wave propagates back.

### Newmark-Beta Time Integration

The second-order ODE `M * a + K * u = f` is integrated implicitly using the
Newmark-beta method:

```
u_{n+1} = u_n + dt * v_n + dt^2 * ( (0.5 - beta) * a_n + beta * a_{n+1} )
v_{n+1} = v_n + dt * ( (1 - gamma) * a_n + gamma * a_{n+1} )
```

With `beta = 0.25, gamma = 0.5` (trapezoidal rule) the scheme is unconditionally
stable — no CFL restriction on the time step. The step `dt = 2e-5 s` is chosen to
resolve the wave profile spatially (approximately 10 time steps per element transit
time) rather than for stability.

### ASCII Diagram of the Problem

```
y=0.5  +========================================================+
       |                                                        |  free
 pulse |   rho*d^2u/dt^2 = div(sigma)                          |  right
 -->   |   E = 200 GPa,  nu = 0,  rho = 7800 kg/m^3           |  end
       |   c = sqrt(E/rho) ~ 5064 m/s                          |
y=0.0  +========================================================+
      x=0                                                     x=10 m

       |--- wave traveling right --->  <--- reflected wave ---|

Boundary conditions:
  left face  : Pressure pulse (traction, time-dependent function)
               disp_y = 0 (no lateral motion at driven end)
  right face : Free (no BC on disp_x — zero traction by default)
  top/bottom : disp_y = 0 (enforces 1D-like axial behavior)

Time steps: dt = 2e-5 s,  end_time = 0.006 s  ->  300 steps
Mesh: 100 x 5 = 500 elements, 606 nodes
```

---

## Input File Walkthrough

### `[Mesh]` Block

```
[Mesh]
  type = GeneratedMesh
  dim  = 2
  nx   = 100
  ny   = 5
  xmin = 0.0
  xmax = 10.0
  ymin = 0.0
  ymax = 0.5
[]
```

A 100 x 5 mesh gives element size `dx = 0.1 m` in x and `dy = 0.1 m` in y. The
100-element resolution in x is what controls wave fidelity: with 100 elements over
10 m, each element is 0.1 m, and the wave at 5064 m/s crosses one element every
`0.1/5064 ~ 2e-5 s` — exactly our time step.

### `[GlobalParams]` Block

```
[GlobalParams]
  displacements = 'disp_x disp_y'
[]
```

Passes the displacement variable names globally so that all solid mechanics objects
(kernels, materials, BCs) know the variable layout without redundant specification.

### `[Physics/SolidMechanics/Dynamic]` Block

```
[Physics]
  [SolidMechanics]
    [Dynamic]
      [all]
        add_variables  = true
        newmark_beta   = 0.25
        newmark_gamma  = 0.5
        strain         = SMALL
        density        = 7800
        generate_output = 'stress_xx stress_yy vonmises_stress'
      []
    []
  []
[]
```

This single block replaces what would otherwise require six separate sections:

1. `[Variables]` — `disp_x`, `disp_y` (created by `add_variables = true`)
2. `[AuxVariables]` — `vel_x`, `vel_y`, `accel_x`, `accel_y`
3. `[Kernels]` — two `StressDivergenceTensors` kernels (x and y)
4. `[Kernels]` — two `InertialForce` kernels wired to the velocity/acceleration AuxVars
5. `[AuxKernels]` — two `NewmarkAccelAux` kernels (update acceleration)
6. `[AuxKernels]` — two `NewmarkVelAux` kernels (update velocity)

**`newmark_beta = 0.25, newmark_gamma = 0.5`**: These are the trapezoidal rule
parameters. `beta = 0.25` means the average of old and new acceleration is used for
displacement update. `gamma = 0.5` means the trapezoidal rule for velocity. Together
they give second-order accuracy in time with no numerical dissipation.

**`density = 7800`**: Steel density in kg/m^3, passed directly to the `InertialForce`
kernels. This is different from a material property — the action wires it internally.

**`generate_output`**: Requests that the action also create AuxVariables and AuxKernels
for the listed stress components, extracted from the stress tensor at each quadrature
point using `RankTwoAux`.

**`strain = SMALL`**: Uses the linearized (small-deformation) strain tensor
`epsilon = 0.5 * (grad(u) + grad(u)^T)`. Appropriate for elastic waves where
displacements are many orders of magnitude smaller than the bar length.

### `[BCs]` Block

```
[BCs]
  [Pressure]
    [pulse_left]
      boundary = left
      function = pressure_pulse
      factor   = 1
    []
  []
  [fix_y_bottom]  ...  [fix_y_top]  ...  [fix_y_left]
[]
```

The `[Pressure]` sub-block applies a traction (force per unit area) normal to the
boundary. This is the Neumann (natural) boundary condition for solid mechanics. The
function `pressure_pulse` defines the time history (see `[Functions]`). A positive
pressure value pushes inward — in the +x direction on the left face — creating
compression.

The `disp_y = 0` DirichletBCs on top, bottom, and left prevent rigid-body motion
and lateral displacements, preserving the 1D wave character.

The right face has **no explicit BC** on `disp_x`. In MOOSE solid mechanics, an
unspecified boundary is naturally traction-free (`sigma . n = 0`), which is exactly
the free-end condition needed for the wave reflection.

### `[Functions]` Block

```
[Functions]
  [pressure_pulse]
    type = PiecewiseLinear
    x = '0.0    0.0002  0.0004  0.0006'
    y = '0.0    1.0e6   1.0e6   0.0'
  []
[]
```

The pulse has a trapezoidal shape: 0.2 ms ramp-up, 0.2 ms hold at 1 MPa, 0.2 ms
ramp-down. Total duration 0.6 ms, roughly one-third of the one-way transit time.
This is short enough that the wave packet is spatially compact and the incident and
reflected waves are visually distinct in a space-time plot.

### `[Materials]` Block

```
[Materials]
  [elasticity]
    type           = ComputeIsotropicElasticityTensor
    youngs_modulus = 200.0e9
    poissons_ratio = 0.0
  []
  [stress]
    type = ComputeLinearElasticStress
  []
[]
```

`ComputeIsotropicElasticityTensor` builds the full 3x3x3x3 elasticity tensor from
the two isotropic constants. With `poissons_ratio = 0.0`, the off-diagonal components
are zero — stress in x produces only strain in x, with no lateral contraction. This
gives a clean 1D wave without bar-mode coupling.

`ComputeLinearElasticStress` computes `sigma = C : epsilon` (double contraction of
the elasticity tensor with the small strain tensor) at every quadrature point and
every time step.

### `[Postprocessors]` Block

```
[Postprocessors]
  [disp_x_right]   -- PointValue at (10.0, 0.25, 0)
  [disp_x_left]    -- PointValue at (0.0,  0.25, 0)
  [avg_stress_xx]  -- ElementAverageValue of stress_xx
[]
```

`PointValue` interpolates the nodal displacement field to a specific geometric
coordinate. Tracking the right-end displacement shows the wave arrival and reflection
event. Tracking the left-end displacement shows the initial driven motion and then
the returning wave.

`ElementAverageValue` of `stress_xx` gives a single scalar for the average axial
stress — useful for checking that the total stress returns toward zero after the
pulse has passed through the bar.

### `[Executioner]` Block

```
[Executioner]
  type      = Transient
  solve_type = 'PJFNK'
  dt        = 2.0e-5
  end_time  = 0.006
  nl_rel_tol = 1e-8
  nl_abs_tol = 1e-12
[]
```

`dt = 2e-5 s` was chosen so that one time step corresponds to the wave crossing
approximately one element (`c * dt / dx = 5064 * 2e-5 / 0.1 = 1.01`). Because the
Newmark scheme is unconditionally stable, the simulation will not blow up — but
choosing `dt` on the order of the wave crossing time per element gives a sharp,
well-resolved wave front in the output.

`end_time = 0.006 s` covers three transit times: first arrival at the right, first
reflection back to the left, and a second rightward propagation.

### `[Outputs]` Block

```
[Outputs]
  csv = true
  [exodus]
    type     = Exodus
    interval = 5
  []
[]
```

`interval = 5` writes Exodus output every 5th time step. With 300 steps total, this
gives 60 spatial snapshots — enough for a smooth animation while keeping the file
size manageable. The CSV output (postprocessors only) writes every step at negligible
cost.

---

## Running the Simulation

```bash
# From the MOOSE build directory or PATH, run:
combined-opt -i case20_elastic_wave.i

# Expected output: 300 time steps, ~20-60 seconds on a modern laptop
# Output files:
#   case20_elastic_wave_out.e    -- Exodus spatial field (60 frames)
#   case20_elastic_wave_out.csv  -- disp_x_right, disp_x_left, avg_stress_xx
```

---

## Expected Results

### CSV Postprocessors

The `disp_x_right` column (axial displacement at the free right end) should show:

| Time range | Behavior |
|------------|----------|
| 0 to ~0.002 s | Near zero — wave has not yet arrived |
| ~0.002 s | Rapid rise — wave front arrives at right end |
| ~0.002 to ~0.004 s | Peak displacement, then gradual decrease as reflected wave departs |
| ~0.004 s onward | Oscillation as multiple reflections accumulate |

The `disp_x_left` column (left end) should show:

| Time range | Behavior |
|------------|----------|
| 0 to ~0.0006 s | Rises with the applied pressure pulse |
| ~0.0006 s onward | Pulse ends, displacement begins to recover |
| ~0.004 s | Reflected tensile wave arrives, pulls left end back |

The `avg_stress_xx` column should start at zero, go negative (compression) as the
pulse propagates, then oscillate with decreasing amplitude as waves reflect back and
forth (no damping in this model, so energy is conserved indefinitely).

### Exodus Visualization in ParaView

Load `case20_elastic_wave_out.e` in ParaView and animate the `disp_x` or
`stress_xx` field:

1. At t=0 the bar is unstressed and at rest.
2. A dark-colored (compressed) band appears at the left face and moves rightward.
3. At t ~ 0.002 s the band reaches the right face; the right-face displacement
   briefly doubles (free-end doubling effect).
4. The band's sign flips (compression becomes tension) and the wave travels back
   leftward as a bright band.
5. Without damping, the wave bounces indefinitely.

To see the wave more clearly, plot `stress_xx` rather than displacement — the stress
field shows the wave front as a sharp spatial gradient.

---

## Key Concepts Learned

| Concept | What It Is | Where in Input File |
|---------|-----------|---------------------|
| `Physics/SolidMechanics/Dynamic` | Action that sets up all dynamic solid mechanics objects | `[Physics]` block |
| Newmark-beta integration | Implicit second-order time integration for `rho*a + K*u = f` | `newmark_beta`, `newmark_gamma` parameters |
| `InertialForce` kernel | Adds `rho * d^2u/dt^2` residual contribution | Created automatically by Dynamic action |
| `StressDivergenceTensors` kernel | Adds `div(sigma)` residual contribution | Created automatically by Dynamic action |
| `Pressure` BC | Applies normal traction to a boundary face | `[BCs][Pressure]` nested sub-block |
| Free boundary condition | Zero traction — achieved by omitting any BC | Right face of bar: no `disp_x` BC |
| `ComputeIsotropicElasticityTensor` | Builds full elasticity tensor from E and nu | `[Materials]` block |
| Longitudinal wave speed | `c = sqrt(E/rho)` — governs wave transit time | Used to select dt and end_time |
| Free-end reflection | Compressive wave reflects as tensile wave | Visible in stress_xx field animation |
| `interval` in Outputs | Write every Nth step to limit file size | `[Outputs][exodus]` block |

---

## Experiments to Try

**Experiment 1: Change the pulse duration**
In `[Functions]`, modify the `x` array to `'0.0 0.00005 0.0001 0.00015'` — a pulse
four times shorter. Run the simulation and observe how the spatial width of the
traveling wave packet changes in ParaView. A shorter pulse in time creates a narrower
spatial packet.

**Experiment 2: Add Rayleigh damping**
In the `[Physics/SolidMechanics/Dynamic]` block, add:
```
zeta  = 1e-5    # stiffness-proportional damping coefficient
eta   = 0.0     # mass-proportional damping coefficient
```
This adds a small amount of viscous damping. After the first reflection, the wave
amplitude should decrease on each subsequent bounce. The CSV postprocessors will
show the oscillation decaying over time rather than being perfectly periodic.

**Experiment 3: Change Poisson's ratio to 0.3 (real steel)**
Set `poissons_ratio = 0.3` in `[Materials]`. Now x-stress produces y-strain and
vice versa. The bar mode velocity changes, and lateral (y-direction) oscillations
appear. The wave front in ParaView will no longer be a perfectly flat vertical band.

**Experiment 4: Lengthen the bar and measure wave speed**
Change `xmax = 20.0` and `nx = 200`. The transit time doubles. Read `disp_x_right`
from the CSV and measure the time at which displacement first exceeds a small
threshold (e.g., 1e-9 m). Divide the bar length (20 m) by this time to compute the
wave speed from the simulation and compare to the theoretical value of 5064 m/s.

**Experiment 5: Fix the right end (compare free vs. fixed reflection)**
Add a Dirichlet BC:
```
[fix_right]
  type     = DirichletBC
  variable = disp_x
  boundary = right
  value    = 0.0
[]
```
At a fixed end, displacement must remain zero, so the reflected wave has the same
sign as the incident wave (compression reflects as compression). Compare the
`disp_x_right` postprocessor: with a fixed end you should see near-zero displacement
at that point (the two superimposed waves cancel), while `stress_xx` doubles at the
fixed wall.
